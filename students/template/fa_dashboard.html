<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FA Dashboard</title>
    <link rel="stylesheet" href="../../resources/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../resources/css/custom.css">
    <link rel="stylesheet" href="../../resources/css/jquery-ui.css">
    <link rel="stylesheet" href="../../resources/css/vendor/all.css">
    <link rel="stylesheet" href="../../resources/css/vendor/mainstyle.css">
    <link rel="stylesheet" href="../../resources/css/customstyle.css">
    <link rel="stylesheet" href="../../resources/css/all.css">
    <script src="../../resources/js/vendor/jquery.min.js"></script>
    <script src="../../resources/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="../../resources/js/vendor/jquery.easing.min.js"></script>
    <script src="../../resources/js/vendor/main.js"></script>
    <script>
        function updateDateTime() {
            var now = new Date();
            var dateTimeString = now.toLocaleString();
            document.getElementById('currentDateTime').innerText = dateTimeString;
        }
    </script>
</head>
<body class="nav-fixed" onload="updateDateTime()">
    <form id="userHomePage" name="userHomePage" method="post">
        <nav class="topnav navbar navbar-expand shadow justify-content-between justify-content-sm-start navbar-light bg-white" id="sidenavAccordion">
            <button class="btn btn-icon btn-transparent-dark order-1 order-lg-0 mr-lg-2" id="sidebarToggle"><i class="fa fa-bars"></i></button>
            <a class="navbar-brand" href="../../students/loginManager/UserHomePage.jsp">
                <img src="../../resources/Image/srmist.png" alt="SRM Logo" />
                <br><font style="font-size: 9pt;">Student Portal</font>
            </a>
            <span class="text-custom d-none d-sm-block"><b>Faculty of Engineering and Technology, Ramapuram, Chennai</b></span>

            <ul class="navbar-nav align-items-center ml-auto text-center">
                <a style='cursor:pointer;'>
                    <span class="dropdown-item" data-toggle="modal" data-target="#logoutModal">
                        <div class="dropdown-item-icon"><i class="fas fa-sign-out-alt"></i></div>
                        Logout
                    </span>
                </a>
            </ul>
        </nav>

        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sidenav shadow-right sidenav-light">
                    <div class="sidenav-menu">
                        <div class="nav accordion" id="accordionSidenav">
                            <div class="sidenav-menu-heading">Core</div>
                            <a class="nav-link" href="fa_dashboard.html">
                                <div class="nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                Dashboard
                            </a>
                            <a class="nav-link" href="logout.html">
                                <div class="nav-link-icon"><i class="fas fa-sign-out-alt"></i></div>
                                Logout
                            </a>
                        </div>
                    </div>
                    <div class="sidenav-footer">
                        <div class="sidenav-footer-content">
                            <div class="sidenav-footer-subtitle"></div>
                            <div class="sidenav-footer-subtitle"></div>
                            <div class="sidenav-footer-title" id="currentDateTime"></div>
                        </div>
                        <input type="hidden" style="color:white;" id="hidchkHostelOpen" name="hidchkHostelOpen" size="10" value="''">
                    </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid">
                        <div class="row justify-content-center">
                            <div class="col-md-8">
                                <div class="card border-custom mb-2 mt-1">
                                    <div class="card-header bg-custom text-white"><i class="fa fa-tachometer-alt"></i> FA Dashboard</div>
                                    <div class="card-body py-1">
                                        <h5 class="card-title">Students Applied for Outpass</h5>
                                        <div id="studentList" class="row">
                                            <!-- Student list will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="outpassDetails" class="row justify-content-center" style="display: none;">
                            <div class="col-md-8">
                                <div class="card border-custom mb-2 mt-1">
                                    <div class="card-header bg-custom text-white"><i class="fa fa-info-circle"></i> Outpass Details</div>
                                    <div class="card-body py-1">
                                        <div id="outpassInfo">
                                            <!-- Outpass details will be populated here -->
                                        </div>
                                        <div class="text-center">
                                            <button class="btn btn-success" id="acceptButton">Accept</button>
                                            <button class="btn btn-danger" id="rejectButton">Reject</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </form>

    <script>
        $(document).ready(function () {
            // Fetch student list from the server
            fetchStudentList();

            // Handle Accept button click
            $('#acceptButton').click(function () {
                handleOutpassAction('accept');
            });

            // Handle Reject button click
            $('#rejectButton').click(function () {
                handleOutpassAction('reject');
            });
        });

        function fetchStudentList() {
            // Dummy data for students
            const students = [
                { id: 1, name: 'John Doe', regNo: '123456' },
                { id: 2, name: 'Jane Smith', regNo: '654321' },
                { id: 3, name: 'Alice Johnson', regNo: '789012' },
                { id: 4, name: 'Bob Brown', regNo: '345678' }
            ];

            let studentListHtml = '';
            students.forEach(student => {
                studentListHtml += `
                    <div class="col-md-6 mb-3">
                        <div class="card student-card" onclick="showOutpassDetails(${student.id})">
                            <div class="card-body">
                                <h5 class="card-title">${student.name}</h5>
                                <p class="card-text">Registration Number: ${student.regNo}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            $('#studentList').html(studentListHtml);
        }

        function showOutpassDetails(studentId) {
            // Dummy data for outpass details
            const outpassDetails = {
                1: { fromDate: '2023-10-01', fromTime: '10:00 AM', toDate: '2023-10-05', toTime: '05:00 PM', reason: 'Family function' },
                2: { fromDate: '2023-10-02', fromTime: '11:00 AM', toDate: '2023-10-06', toTime: '06:00 PM', reason: 'Medical appointment' },
                3: { fromDate: '2023-10-03', fromTime: '12:00 PM', toDate: '2023-10-07', toTime: '07:00 PM', reason: 'Personal work' },
                4: { fromDate: '2023-10-04', fromTime: '01:00 PM', toDate: '2023-10-08', toTime: '08:00 PM', reason: 'Vacation' }
            };

            const details = outpassDetails[studentId];

            let outpassInfoHtml = `
                <p><strong>From:</strong> ${details.fromDate} ${details.fromTime}</p>
                <p><strong>To:</strong> ${details.toDate} ${details.toTime}</p>
                <p><strong>Reason:</strong> ${details.reason}</p>
            `;
            $('#outpassInfo').html(outpassInfoHtml);
            $('#outpassDetails').show();
        }

        function handleOutpassAction(action) {
            // Example data, replace with actual AJAX call to handle the action
            const studentId = 1; // Replace with actual student ID
            const actionUrl = action === 'accept' ? 'accept_outpass.php' : 'reject_outpass.php';

            $.post(actionUrl, { studentId: studentId }, function (response) {
                alert(`Outpass ${action}ed successfully!`);
                $('#outpassDetails').hide();
                fetchStudentList();
            });
        }
    </script>
</body>
</html>